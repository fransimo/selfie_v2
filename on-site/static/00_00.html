<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>0.0</title>
    <link href="1080_1920.css" rel="stylesheet">
    <script src="/static/js/html2canvas.min.js">
    </script>

    <script>
      var timeOutVar;

      function changeImage() {
        image = document.getElementById('imgDisp');
        if (image.src.endsWith("videos/00_00_2015_01_30_ecorenal_vesi.gif") ) {
          image.src = "videos/00_01_2019_08_22_ecorenal_vesi.gif";
        } else if (image.src.endsWith("videos/00_01_2019_08_22_ecorenal_vesi.gif") ) {
          image.src = "videos/00_02_2020_10_26_ecorenal_vesi.gif";
        } else {
          image.src = "videos/00_00_2015_01_30_ecorenal_vesi.gif";
        }
        timeOutVar = setTimeout(changeImage, 10000);
      }

      setTimeout(function () {
        changeImage();
      }, 10000);

      function clearQR() {
        image = document.getElementById('qr');
        image.src = "";
      }

      document.addEventListener('keydown', (event) => {  // take the selfie and send it to the server
        const keyName = event.key;

        if (keyName === 'Enter') {

          const img = document.getElementById("qr");
          const url = "/takeSnapShot";
          var xhr = new XMLHttpRequest();

          xhr.open("POST", url, true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  var json = JSON.parse(xhr.responseText);
                  img.src = json.qr;
                  console.log(json.qr);
                  timeOutVar = setTimeout(clearQR, 7000);
              }
          };

          xhr.send();

          return;
        }

      }, false);

  </script>

  </head>
  <body>
    <main>
      <mirror>
        <video class="webcam" autoplay ></video>
      </mirror>
      <script>
        const constraints = {
          audio: false,
          video: {"height":{"exact":240},"width":{"exact":320}}
        };

        const video = document.querySelector("video");

        navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
          video.srcObject = stream;
        });
      </script>

      <img id="qr" class="qr" src="" />
      <img id="imgDisp" class="rinyones" src="videos/00_00_2015_01_30_ecorenal_vesi.gif" />

    </main>
  </body>
</html>

<!--
Result constraints: {"height":{"exact":1080},"width":{"exact":1920}}
main.js:97 Result constraints: {"height":{"exact":480},"width":{"exact":640}}
main.js:124 resize: Actual video dimensions: 640x480px.
main.js:97 Result constraints: {"height":{"exact":720},"width":{"exact":1280}}
main.js:124 resize: Actual video dimensions: 1280x720px.
main.js:97 Result constraints: {"height":{"exact":480},"width":{"exact":640}}
main.js:124 resize: Actual video dimensions: 640x480px.
main.js:97 Result constraints: {"height":{"exact":240},"width":{"exact":320}}
-->
